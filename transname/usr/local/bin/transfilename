#!/bin/bash

# Fun√ß√£o: Mostrar ajuda
mostrar_ajuda() {
    echo "$0 - Traduz nomes de arquivos para outro idioma usando translate-shell"
    echo
    echo "Uso: $0 [op√ß√µes] arquivo1 [arquivo2 ...]"
    echo ""
    echo "Op√ß√µes:"
    echo "  -t <idioma>         Especifica o idioma de destino (ex: en, es, fr)"
    echo "  --list-languages    Lista os idiomas suportados pelo translate-shell"
    echo "  --help              Mostra esta ajuda"
    echo ""
    echo "Se nenhum idioma for especificado, o script usar√° o idioma do sistema."
    echo "Exemplos:"
    echo "  $0 relatorio.txt imagem.jpg"
    echo "  $0 -t fr documento.pdf"
    echo "  $0 --list-languages"
    exit 0
}

# Fun√ß√£o: Detectar idioma do sistema
detectar_idioma_sistema() {
    echo "$LANG" | cut -d'.' -f1 | cut -d'_' -f1
}

# Fun√ß√£o: Verificar depend√™ncias
verificar_dependencias() {
    if ! command -v trans &> /dev/null; then
        echo "translate-shell n√£o est√° instalado. Instale com:"
        echo "  sudo apt install translate-shell"
        exit 1
    fi
}

# Fun√ß√£o: Processar argumentos
processar_argumentos() {
    while [[ "$1" == -* ]]; do
        case "$1" in
            -t)
                shift
                IDIOMA_DESTINO="$1"
                shift
                ;;
            --list-languages)
                echo "üåç Idiomas suportados pelo translate-shell:"
                trans -R
                exit 0
                ;;
            --help)
                mostrar_ajuda
                ;;
            *)
                echo "‚ùå Op√ß√£o inv√°lida: $1"
                mostrar_ajuda
                ;;
        esac
    done
    ARQUIVOS=("$@")
}

# Fun√ß√£o: Traduzir e renomear arquivo
traduzir_arquivo() {
    local ARQ="$1"

    if [ ! -f "$ARQ" ]; then
        echo "‚ö†Ô∏è Arquivo n√£o encontrado: $ARQ"
        return
    fi

    local BASENAME=$(basename "$ARQ")
    local DIRNAME=$(dirname "$ARQ")
    local NOME EXT SEPARADOR

    if [[ "$BASENAME" == *.* ]]; then
        NOME="${BASENAME%.*}"
        EXT=".${BASENAME##*.}"
    else
        NOME="$BASENAME"
        EXT=""
    fi

    if [[ "$NOME" == *"_"* ]]; then
        SEPARADOR="_"
    elif [[ "$NOME" == *"-"* ]]; then
        SEPARADOR="-"
    elif [[ "$NOME" == *"."* ]]; then
        SEPARADOR="."
    else
        SEPARADOR=" "
    fi

    IFS="$SEPARADOR" read -ra PALAVRAS <<< "$NOME"
    PALAVRAS_TRADUZIDAS=()

    for PALAVRA in "${PALAVRAS[@]}"; do
        TRADUZIDA=$(trans -b ":$IDIOMA_DESTINO" "$PALAVRA" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/_/g')
        PALAVRAS_TRADUZIDAS+=("$TRADUZIDA")
    done

    local TRADUZIDO_LIMPO
    TRADUZIDO_LIMPO=$(IFS="$SEPARADOR"; echo "${PALAVRAS_TRADUZIDAS[*]}")
    local NOVO_NOME="${TRADUZIDO_LIMPO}${EXT}"

    mv "$ARQ" "$DIRNAME/$NOVO_NOME"
    echo "‚úÖ Renomeado: $BASENAME ‚Üí $NOVO_NOME"
}

# Fun√ß√£o principal
main() {
    IDIOMA_DESTINO=$(detectar_idioma_sistema)

    processar_argumentos "$@"
    verificar_dependencias

    if [ "${#ARQUIVOS[@]}" -eq 0 ]; then
        echo "‚ö†Ô∏è Nenhum arquivo especificado."
        mostrar_ajuda
    fi

    for ARQ in "${ARQUIVOS[@]}"; do
        traduzir_arquivo "$ARQ"
    done
}

# Execu√ß√£o
main "$@"
