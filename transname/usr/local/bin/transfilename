#!/bin/bash

# Fun√ß√£o de ajuda
mostrar_ajuda() {
    echo "$0 - Traduz nomes de arquivos para outro idioma usando translate-shell"
    echo
    echo "Uso: $0 [op√ß√µes] arquivo1 [arquivo2 ...]"
    echo ""
    echo "Op√ß√µes:"
    echo "  -t <idioma>         Especifica o idioma de destino (ex: en, es, fr)"
    echo "  --list-languages    Lista os idiomas suportados pelo translate-shell"
    echo "  --help              Mostra esta ajuda"
    echo ""
    echo "Se nenhum idioma for especificado, o script usar√° o idioma do sistema."
    echo "Exemplos:"
    echo "  $0 relatorio.txt imagem.jpg"
    echo "  $0 -t fr documento.pdf"
    echo "  $0 --list-languages"
    exit 0
}

# Detecta idioma do sistema
IDIOMA_SISTEMA=$(echo "$LANG" | cut -d'.' -f1 | cut -d'_' -f1)
IDIOMA_DESTINO="$IDIOMA_SISTEMA"

# Processa op√ß√µes
while [[ "$1" == -* ]]; do
    case "$1" in
        -t)
            shift
            IDIOMA_DESTINO="$1"
            shift
            ;;
        --list-languages)
            echo "üåç Idiomas suportados pelo translate-shell:"
            trans -R
            exit 0
            ;;
        --help)
            mostrar_ajuda
            ;;
        *)
            echo "‚ùå Op√ß√£o inv√°lida: $1"
            mostrar_ajuda
            ;;
    esac
done

# Verifica se translate-shell est√° instalado
if ! command -v trans &> /dev/null; then
    echo "translate-shell n√£o est√° instalado. Instale com:"
    echo "  sudo apt install translate-shell"
    exit 1
fi

# Verifica se arquivos foram fornecidos
if [ "$#" -eq 0 ]; then
    echo "‚ö†Ô∏è Nenhum arquivo especificado."
    mostrar_ajuda
fi

# Processa cada arquivo
for ARQ in "$@"; do
    if [ -f "$ARQ" ]; then
        BASENAME=$(basename "$ARQ")

        # Separa nome e extens√£o
        if [[ "$BASENAME" == *.* ]]; then
            NOME="${BASENAME%.*}"
            EXT=".${BASENAME##*.}"
        else
            NOME="$BASENAME"
            EXT=""
        fi

        # Detecta separador principal
        if [[ "$NOME" == *"_"* ]]; then
            SEPARADOR="_"
        elif [[ "$NOME" == *"-"* ]]; then
            SEPARADOR="-"
        elif [[ "$NOME" == *"."* ]]; then
            SEPARADOR="."
        else
            SEPARADOR=" "
        fi

        # Divide e traduz cada palavra
        IFS="$SEPARADOR" read -ra PALAVRAS <<< "$NOME"
        PALAVRAS_TRADUZIDAS=()

        for PALAVRA in "${PALAVRAS[@]}"; do
            TRADUZIDA=$(trans -b ":$IDIOMA_DESTINO" "$PALAVRA" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/_/g')
            PALAVRAS_TRADUZIDAS+=("$TRADUZIDA")
        done

        # Junta com o separador original
        TRADUZIDO_LIMPO=$(IFS="$SEPARADOR"; echo "${PALAVRAS_TRADUZIDAS[*]}")
        NOVO_NOME="${TRADUZIDO_LIMPO}${EXT}"

        mv "$ARQ" "$(dirname "$ARQ")/$NOVO_NOME"
        echo "‚úÖ Renomeado: $BASENAME ‚Üí $NOVO_NOME"
    else
        echo "‚ö†Ô∏è Arquivo n√£o encontrado: $ARQ"
    fi
done

